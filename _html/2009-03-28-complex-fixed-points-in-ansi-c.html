---
layout: post
title: Complex Fixed-points in ANSI C
date: '2009-03-28T14:14:00.001+08:00'
author: 史蛋利九的部落格
tags:
- SystemC
- 科技先知
modified_time: '2011-01-10T23:08:01.185+08:00'
thumbnail: http://4.bp.blogspot.com/_4T1r1rg9hZ8/SdD4N_JyqrI/AAAAAAAAACk/vqEVmlKef3E/s72-c/DSC_6855_m.jpg
blogger_id: tag:blogger.com,1999:blog-7536266430143612441.post-5902620233912682661
blogger_orig_url: https://stanlly9.blogspot.com/2009/03/complex-fixed-points-in-ansi-c.html
---

<span style="color: #3366ff; font-size: 130%; font-weight: bold;">A</span><span style="font-size: 100%;"><span style="font-size: 130%;">s I mentioned before, SystemC provides a series well-define classes for fixed-point.  For more details I will summarize them and make a short intro in these days.  Here, I'll show you another way, in ANSI C, to write for my own fixed-point simulation.  And it's fully compatiable with gcc.</span><br />Here is my cmplx_fix.h (header file for complex fixed-point)</span><br /><span class="fullpost"><br /><code><span style="color: #006600;"><br />//+FHDR------------------------------------------------<br />// (C) Copyright Company NTHU.EE VLSI Comm Lab.2009<br />// All Right Reserved<br />//-----------------------------------------------------<br />// FILE NAME: cmplx_fix.h<br />// AUTHOR: stanlly9<br />// CONTACT INFORMATION: stanlly9.blogspot.com<br />//-----------------------------------------------------<br />// RELEASE VERSION: V 1.0<br />// VERSION DESCRIPTION:<br />// 1.0  First release<br />//-----------------------------------------------------<br />// RELEASE DATE: Mar-25-2009<br />//-----------------------------------------------------<br />// PURPOSE: Complex fixed point<br />//-FHDR------------------------------------------------</span><br /><span style="color: #6600cc;"><br />#ifndef _CMPLX_FX_HDR<br />#define _CMPLX_FX_HDR<br /></span><br /><span style="color: #6600cc;">#define IWL 7</span><span style="color: #006600;">//integer word-length</span><br /><span style="color: #6600cc;">#define DWL 9</span> <span style="color: #006600;">//decimal fraction word-length<br />//IWL+DWL=sizeof(short int)*2=16</span><br />typedef struct  {<br />short int re;<br />short int im;<br />} cmplx_fix;<br /><span style="color: #006600;">//check negaitve</span><br />int is_neg(short int);<br /><span style="color: #006600;">//cmplx_fix fcns</span><br />void cf_print(cmplx_fix);<span style="color: #006600;">//printer</span><br />void cf_seti_re(cmplx_fix*, int);<span style="color: #006600;">//set rel part by integer values</span><br />void cf_seti_im(cmplx_fix*, int);<span style="color: #006600;">//set img part by integer values</span><br />void cf_setf_re(cmplx_fix*, float);<span style="color: #006600;">//set rel part by float values</span><br />void cf_setf_im(cmplx_fix*, float);<span style="color: #006600;">//set img part by float values</span><br /><br /><span style="color: #006600;">//--cmplx_fix operator fcns--</span><br /><span style="color: #006600;">//----cmplx_fix to cmplx_fix----</span><br />cmplx_fix cf_add(cmplx_fix, cmplx_fix);<span style="color: #006600;">// +</span><br />cmplx_fix cf_sub(cmplx_fix, cmplx_fix);<span style="color: #006600;">// -</span><br />cmplx_fix cf_mul(cmplx_fix, cmplx_fix);<span style="color: #006600;">// *</span><br />cmplx_fix cf_div(cmplx_fix, cmplx_fix);<span style="color: #006600;">// /</span><br /><span style="color: #006600;">//----cmplx_fix to integer values----</span><br />cmplx_fix cf_add_re(cmplx_fix, int); <span style="color: #006600;">// + real</span><br />cmplx_fix cf_add_im(cmplx_fix, int); <span style="color: #006600;">// + imag</span><br /><span style="color: #006600;">//cmplx_fix cf_sub_re(cmplx_fix, int); // - real as _add_re(-int)</span><br /><span style="color: #006600;">//cmplx_fix cf_sub_im(cmplx_fix, int); // - imag as _add_im(-int)</span><br />cmplx_fix cf_mul_re(cmplx_fix, int); <span style="color: #006600;">// * real</span><br />cmplx_fix cf_mul_im(cmplx_fix, int); <span style="color: #006600;">// * imag</span><br />cmplx_fix cf_div_re(cmplx_fix, int); <span style="color: #006600;">// / real</span><br />cmplx_fix cf_div_im(cmplx_fix, int); <span style="color: #006600;">// / imag</span><br /><span style="color: #6600cc;">#endif</span><br /><br /></code><br /><a href="http://4.bp.blogspot.com/_4T1r1rg9hZ8/SdD4N_JyqrI/AAAAAAAAACk/vqEVmlKef3E/s1600-h/DSC_6855_m.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" src="http://4.bp.blogspot.com/_4T1r1rg9hZ8/SdD4N_JyqrI/AAAAAAAAACk/vqEVmlKef3E/s320/DSC_6855_m.jpg" /></a><span style="font-size: 130%;"><span style="font-family: times new roman;">In </span><span style="color: #6633ff; font-family: times new roman;">ANSI C</span><span style="font-family: times new roman;">, we don't have much useful programming shortcuts,</span><br /><span style="font-family: times new roman;"><span style="color: #ff6600;">no classes, no functional overridding, no operator overridding</span>, etc</span><br /><span style="font-family: times new roman;">All things we can do is function calls, such as the function:</span><br /><span style="font-family: times new roman;"><span style="font-style: italic;">cf_print()</span> is self-made print function.</span><br /><span style="font-family: times new roman;"><span style="font-style: italic;">cf_add()</span> is the func for my cmplx_fix addition.</span><br /><br /><span style="font-family: times new roman;">For the cmplx_fix structure contains two members:</span><br /><span style="font-family: times new roman;"><span style="color: red;">re</span> is the real part</span><br /><span style="font-family: times new roman;"><span style="color: red;">im</span> is the imalge part</span><br /><span style="font-family: times new roman;">They are in a <span style="color: #3333ff;">short int </span>datatypes(signed 16bits each) for reducing memory allocation.</span><br /><span style="font-family: times new roman;">The interger word-length is define by<span style="color: #3333ff;"> IWL</span>, decimal fraction part by <span style="color: #3333ff;">DWL</span></span><br /><br /><span style="font-family: times new roman;">In these version, I do not perform the overflow and stratuation processing.</span><br /><span style="font-family: times new roman;">It may be improved in the future.</span><br /><span style="font-family: times new roman;">The cmplx_fix addition function cf_add() is shwon as an example here</span>:</span><br /><code><span style="color: #006600;">//cmplx_fix + cmplx_fix</span><br />cmplx_fix cf_add(cmplx_fix a, cmplx_fix b)<br />{<br /><span style="color: #3333ff;">short int</span> real = a.re + b.re;<br /><span style="color: #3333ff;">short int</span> imag = a.im + b.im;<br />a.re = (<span style="color: #3333ff;">short int</span>) real;<br />a.im = (<span style="color: #3333ff;">short int</span>) imag;<br /><span style="color: #3333ff;">return</span> a;<br />}<br /></code><br /></span>